<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="在学习的路上，不忘初心 方得始终">
<meta property="og:type" content="website">
<meta property="og:title" content="fgyong的技术博客">
<meta property="og:url" content="http://fgyong.cn/page/4/index.html">
<meta property="og:site_name" content="fgyong的技术博客">
<meta property="og:description" content="在学习的路上，不忘初心 方得始终">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="fgyong的技术博客">
<meta name="twitter:description" content="在学习的路上，不忘初心 方得始终">



  <link rel="alternate" href="/atom.xml" title="fgyong的技术博客" type="application/atom+xml">




  <link rel="canonical" href="http://fgyong.cn/page/4/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>fgyong的技术博客</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">fgyong的技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">不忘初心 方得始终</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fgyong.cn/2016/03/31/iOS线程之NSOperation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fgyong">
      <meta itemprop="description" content="在学习的路上，不忘初心 方得始终">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fgyong的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/03/31/iOS线程之NSOperation/" class="post-title-link" itemprop="http://fgyong.cn/page/4/index.html">iOS线程之NSOperation</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-03-31 14:47:47" itemprop="dateCreated datePublished" datetime="2016-03-31T14:47:47+08:00">2016-03-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-03 16:24:13" itemprop="dateModified" datetime="2020-09-03T16:24:13+08:00">2020-09-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前篇文章已经讲了GCD了，那么这两者有什么区别？</p>
<h3 id="GCD-VS-NSOperation"><a href="#GCD-VS-NSOperation" class="headerlink" title="GCD VS   NSOperation"></a>GCD VS   NSOperation</h3><blockquote>
<p>“NSOperationQueue predates Grand Central Dispatch and on iOS it doesn’t use GCD to execute operations (this is different on Mac OS X). It uses regular background threads which have a little more overhead than GCD dispatch queues.<br>On the other hand, NSOperationQueue gives you a lot more control over how your operations are executed. You can define dependencies between individual operations for example, which isn’t possible with plain GCD queues. It is also possible to cancel operations that have been enqueued in an NSOperationQueue (as far as the operations support it). When you enqueue a block in a GCD dispatch queue, it will definitely be executed at some point.<br>To sum it up, NSOperationQueue can be more suitable for long-running operations that may need to be cancelled or have complex dependencies. GCD dispatch queues are better for short tasks that should have minimum performance and memory overhead.”</p>
</blockquote>
<p>简单来说就是GCD偏底层点，性能好，依赖关系少，并发耗费资源少。<br>NSOperation可观察状态，性能也不错，处理事务更简单操作。</p>
<p>对于这两种都熟练运用的人来说，无所谓了，APP大多数事务这两者都能完美解决。至于代码用哪个这个取决于你的兴趣了。</p>
<p>下面详细说一下NSOperation</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">@interface NSOperation : NSObject &#123;</span><br><span class="line"></span><br><span class="line">- (void)start; //开始执行 默认是同步执行的</span><br><span class="line">- (void)main; //主任务的函数 </span><br><span class="line"></span><br><span class="line">@property (readonly, getter=isCancelled) BOOL cancelled; //是否取消</span><br><span class="line">- (void)cancel; //取消任务</span><br><span class="line"></span><br><span class="line">@property (readonly, getter=isExecuting) BOOL executing;//是否正在执行</span><br><span class="line">@property (readonly, getter=isFinished) BOOL finished; //是否完成</span><br><span class="line">@property (readonly, getter=isConcurrent) BOOL concurrent; // To be deprecated; use and override &apos;asynchronous&apos; below 是否并行</span><br><span class="line">@property (readonly, getter=isAsynchronous) BOOL asynchronous NS_AVAILABLE(10_8, 7_0); //是否异步</span><br><span class="line">@property (readonly, getter=isReady) BOOL ready; //是否正在等待</span><br><span class="line"></span><br><span class="line">- (void)addDependency:(NSOperation *)op; //添加依赖</span><br><span class="line">- (void)removeDependency:(NSOperation *)op; //删除依赖关系</span><br><span class="line"></span><br><span class="line">@property (readonly, copy) NSArray&lt;NSOperation *&gt; *dependencies; //所有依赖关系的数组</span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger, NSOperationQueuePriority) &#123;</span><br><span class="line">//队列优先级  优先级高的先执行 一般设置为0 即 NSOperationQueuePriorityNormal。</span><br><span class="line"> NSOperationQueuePriorityVeryLow = -8L,</span><br><span class="line"> NSOperationQueuePriorityLow = -4L,</span><br><span class="line"> NSOperationQueuePriorityNormal = 0,</span><br><span class="line"> NSOperationQueuePriorityHigh = 4,</span><br><span class="line"> NSOperationQueuePriorityVeryHigh = 8</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@property NSOperationQueuePriority queuePriority;//队列优先级</span><br><span class="line"></span><br><span class="line">@property (nullable, copy) void (^completionBlock)(void)  NS_AVAILABLE(10_6, 4_0);//完成时候执行的代码块</span><br><span class="line">//等待直到完成</span><br><span class="line">- (void)waitUntilFinished NS_AVAILABLE(10_6, 4_0);</span><br><span class="line">//线程优先级</span><br><span class="line">@property double threadPriority NS_DEPRECATED(10_6, 10_10, 4_0, 8_0);</span><br><span class="line"></span><br><span class="line">@property NSQualityOfService qualityOfService NS_AVAILABLE(10_10, 8_0);</span><br><span class="line">NSQualityOfService 的几个枚举值：</span><br><span class="line">  NSQualityOfServiceUserInteractive：最高优先级，主要用于提供交互UI的操作，比如处理点击事件，绘制图像到屏幕上</span><br><span class="line">  NSQualityOfServiceUserInitiated：次高优先级，主要用于执行需要立即返回的任务</span><br><span class="line">  NSQualityOfServiceDefault：默认优先级，当没有设置优先级的时候，线程默认优先级</span><br><span class="line">  NSQualityOfServiceUtility：普通优先级，主要用于不需要立即返回的任务</span><br><span class="line">  NSQualityOfServiceBackground：后台优先级，用于完全不紧急的任务</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//名字</span><br><span class="line">@property (nullable, copy) NSString *name NS_AVAILABLE(10_10, 8_0);</span><br></pre></td></tr></table></figure>
<h3 id="NSBlockOperation"><a href="#NSBlockOperation" class="headerlink" title="NSBlockOperation"></a>NSBlockOperation</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">- (void)print&#123;</span><br><span class="line">    NSLog(@&quot;线程info : %@&quot;,[NSThread currentThread]);</span><br><span class="line">&#125;</span><br><span class="line">- (void)test4&#123;</span><br><span class="line">    NSBlockOperation * blop = [[NSBlockOperation alloc]init];</span><br><span class="line">    [blop addExecutionBlock:^&#123;//添加同时执行的task</span><br><span class="line">        NSLog(@&quot;1 start&quot;);</span><br><span class="line">        [self print];</span><br><span class="line">        sleep(2);</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;1 end&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">    [blop addExecutionBlock:^&#123; //添加同时执行的task</span><br><span class="line">        NSLog(@&quot;2 start&quot;);</span><br><span class="line">        [self print];</span><br><span class="line">        sleep(4);</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;2 end&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">    [blop addExecutionBlock:^&#123; //添加同时执行的task</span><br><span class="line">        NSLog(@&quot;3 start&quot;);</span><br><span class="line">        [self print];</span><br><span class="line">        sleep(1);</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;3 end&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">    [blop setCompletionBlock:^&#123; //添加同时执行的task</span><br><span class="line">        NSLog(@&quot;blop end&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [blop start];</span><br><span class="line">&#125;</span><br><span class="line">输出：</span><br><span class="line">**2016-03-29 16:47:44.857 GCD_Demo[17555:562249] 1 start**</span><br><span class="line">**2016-03-29 16:47:44.857 GCD_Demo[17555:562287] 3 start**</span><br><span class="line">**2016-03-29 16:47:44.857 GCD_Demo[17555:562288] 2 start**</span><br><span class="line">**2016-03-29 16:47:44.857 GCD_Demo[17555:562249] ****线程****info : &lt;NSThread: 0x7fea68408b30&gt;&#123;number = 1, name = main&#125;**</span><br><span class="line">**2016-03-29 16:47:44.857 GCD_Demo[17555:562288] ****线程****info : &lt;NSThread: 0x7fea6861fb30&gt;&#123;number = 3, name = (null)&#125;**</span><br><span class="line">**2016-03-29 16:47:44.857 GCD_Demo[17555:562287] ****线程****info : &lt;NSThread: 0x7fea69300470&gt;&#123;number = 2, name = (null)&#125;**</span><br><span class="line">**2016-03-29 16:47:45.922 GCD_Demo[17555:562287] 3 end**</span><br><span class="line">**2016-03-29 16:47:46.858 GCD_Demo[17555:562249] 1 end**</span><br><span class="line">**2016-03-29 16:47:48.928 GCD_Demo[17555:562288] 2 end**</span><br><span class="line">**2016-03-29 16:47:48.929 GCD_Demo[17555:562288] blop end**</span><br></pre></td></tr></table></figure>
<p>可以看出来，NSBlockOperation当任务是1的时候在main线程中执行，任务大于1的时候，其他的个自独自开了线程，而且互不影响。</p>
<h3 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a>依赖关系</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">- (void)print&#123;</span><br><span class="line">    NSLog(@&quot;线程info : %@&quot;,[NSThread currentThread]);</span><br><span class="line">&#125;</span><br><span class="line">- (void)test4&#123;</span><br><span class="line">    NSBlockOperation * blop = [[NSBlockOperation alloc]init];</span><br><span class="line">    [blop addExecutionBlock:^&#123;</span><br><span class="line">        NSLog(@&quot;blop1_1 start&quot;);</span><br><span class="line">        [self print];</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;blop1_1 end&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">    [blop addExecutionBlock:^&#123;</span><br><span class="line">        NSLog(@&quot;blop1_2 start&quot;);</span><br><span class="line">        [self print];</span><br><span class="line">        sleep(4);</span><br><span class="line">        NSLog(@&quot;blop1_2 end&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">    NSLog(@&quot;blop will start&quot;);</span><br><span class="line">    [blop start];</span><br><span class="line">    NSLog(@&quot;blop did start&quot;);</span><br><span class="line">    </span><br><span class="line">    NSBlockOperation * blop2 =[NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">        NSLog(@&quot;blop2 start&quot;);</span><br><span class="line">        [self print];</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;blop2 end&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">   // [blop2 addDependency:blop];//blop2 依赖blop 就是blopExecutionBlock 执行完之后再执行blop2的任务【blop2 执行task和blop 的CompletionBlock基本是同时执行的】</span><br><span class="line">    [blop2 start];</span><br><span class="line">输出：</span><br><span class="line">**2016-03-29 17:06:53.217 GCD_Demo[17806:574416] blop will start**</span><br><span class="line">**2016-03-29 17:06:53.217 GCD_Demo[17806:574416] blop1_1 start**</span><br><span class="line">**2016-03-29 17:06:53.217 GCD_Demo[17806:574455] blop1_2 start**</span><br><span class="line">**2016-03-29 17:06:53.217 GCD_Demo[17806:574416] ****线程****info : &lt;NSThread: 0x7f839a004ff0&gt;&#123;number = 1, name = main&#125;**</span><br><span class="line">**2016-03-29 17:06:53.218 GCD_Demo[17806:574455] ****线程****info : &lt;NSThread: 0x7f8398416d80&gt;&#123;number = 2, name = (null)&#125;**</span><br><span class="line">**2016-03-29 17:06:55.219 GCD_Demo[17806:574416] blop1_1 end**</span><br><span class="line">**2016-03-29 17:06:57.272 GCD_Demo[17806:574455] blop1_2 end**</span><br><span class="line">**2016-03-29 17:06:57.272 GCD_Demo[17806:574416] blop did start**</span><br><span class="line">**2016-03-29 17:06:57.273 GCD_Demo[17806:574416] blop2 start**</span><br><span class="line">**2016-03-29 17:06:57.273 GCD_Demo[17806:574416] ****线程****info : &lt;NSThread: 0x7f839a004ff0&gt;&#123;number = 1, name = main&#125;**</span><br><span class="line">**2016-03-29 17:06:59.274 GCD_Demo[17806:574416] blop2 end**</span><br></pre></td></tr></table></figure>
<p>从输出的信息可以看出来，block是同步执行的，虽然多任务是多线程，但是主线程还是在阻塞中，只有上一个所有 task 执行完的时候，才会执行下边的task。所以在这里依赖关系不那么重要了，注释掉运行结果也一样的。</p>
<h3 id="NSInvocationOperation"><a href="#NSInvocationOperation" class="headerlink" title="NSInvocationOperation"></a>NSInvocationOperation</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NSInvocationOperation 是NSOperation的子类，负责实现operation的SEL方法。</span><br><span class="line">这样子operation就可以start的时候执行一些函数了。</span><br><span class="line">在swift中已经废弃</span><br><span class="line">看文档：</span><br><span class="line">NS_SWIFT_UNAVAILABLE(&quot;NSInvocation and related APIs not available&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="NSOperationQueue"><a href="#NSOperationQueue" class="headerlink" title="NSOperationQueue"></a>NSOperationQueue</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">//添加操作</span><br><span class="line">- (void)addOperation:(NSOperation *)op;</span><br><span class="line">//添加操作数组 在完成操作的时候</span><br><span class="line">- (void)addOperations:(NSArray&lt;NSOperation *&gt; *)ops waitUntilFinished:(BOOL)wait NS_AVAILABLE(10_6, 4_0);</span><br><span class="line">//添加携带代码块的operation</span><br><span class="line">- (void)addOperationWithBlock:(void (^)(void))block NS_AVAILABLE(10_6, 4_0);</span><br><span class="line">//所有的操作 组成的数组 可读属性</span><br><span class="line">@property (readonly, copy) NSArray&lt;__kindof NSOperation *&gt; *operations;</span><br><span class="line">//操作个数</span><br><span class="line">@property (readonly) NSUInteger operationCount NS_AVAILABLE(10_6, 4_0);</span><br><span class="line">//设置最大并行的任务数 ps:operation 其实 一个operation可以同时开启几个线程的。</span><br><span class="line">@property NSInteger maxConcurrentOperationCount;</span><br><span class="line">//挂起</span><br><span class="line">@property (getter=isSuspended) BOOL suspended;</span><br><span class="line">//队列的名字</span><br><span class="line">@property (nullable, copy) NSString *name NS_AVAILABLE(10_6, 4_0);</span><br><span class="line">//优先级</span><br><span class="line">@property NSQualityOfService qualityOfService NS_AVAILABLE(10_10, 8_0);</span><br><span class="line">队列</span><br><span class="line">@property (nullable, assign /* actually retain */) dispatch_queue_t underlyingQueue NS_AVAILABLE(10_10, 8_0);</span><br><span class="line">//取消所有的操作</span><br><span class="line">- (void)cancelAllOperations;</span><br><span class="line">//等到他们的操作结束</span><br><span class="line">- (void)waitUntilAllOperationsAreFinished;</span><br><span class="line">//当前的队列</span><br><span class="line">+ (nullable NSOperationQueue *)currentQueue NS_AVAILABLE(10_6, 4_0);</span><br><span class="line">//主队列</span><br><span class="line">+ (NSOperationQueue *)mainQueue NS_AVAILABLE(10_6, 4_0);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"># 队列的例子</span><br><span class="line">#队列中添加的operation都是在子线程中执行的。</span><br><span class="line">- (void)print&#123;</span><br><span class="line">    NSLog(@&quot;线程info : %@&quot;,[NSThread currentThread]);</span><br><span class="line">&#125;</span><br><span class="line">- (void)op1&#123;</span><br><span class="line">     NSLog(@&quot;op1 开始运行了&quot;);</span><br><span class="line">     sleep(3);</span><br><span class="line">     NSLog(@&quot;op1 结束&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)test5&#123;</span><br><span class="line">    NSInvocationOperation * op1 =[[NSInvocationOperation alloc]initWithTarget:self selector:@selector(op1) object:nil];</span><br><span class="line">    NSOperationQueue * queue =[[NSOperationQueue alloc]init];</span><br><span class="line">    [queue addOperation:op1]; //添加操作</span><br><span class="line">    queue.maxConcurrentOperationCount = 1;//同时允许一个operation运行</span><br><span class="line">    NSBlockOperation *block = [self test4];//任务块</span><br><span class="line">    [queue addOperation:block];//添加任务块并运行</span><br><span class="line"></span><br><span class="line">// sleep(2);  </span><br><span class="line">   // [queue cancelAllOperations];</span><br><span class="line">&#125;</span><br><span class="line">- (NSBlockOperation *)test4&#123;</span><br><span class="line">    NSBlockOperation * blop = [[NSBlockOperation alloc]init];</span><br><span class="line">    [blop addExecutionBlock:^&#123;</span><br><span class="line">        NSLog(@&quot;blop1_1 start&quot;);</span><br><span class="line">        [self print];</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;blop1_1 end&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">    [blop addExecutionBlock:^&#123;</span><br><span class="line">        NSLog(@&quot;blop1_2 start&quot;);</span><br><span class="line">        [self print];</span><br><span class="line">        sleep(4);</span><br><span class="line">        NSLog(@&quot;blop1_2 end&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">    return blop;</span><br><span class="line">&#125;</span><br><span class="line">输出：</span><br><span class="line">**2016-03-31 11:22:16.663 GCD_Demo[26038:889212] op1 ****开始运行了**</span><br><span class="line">**2016-03-31 11:22:19.737 GCD_Demo[26038:889212] op1 ****结束**</span><br><span class="line">**2016-03-31 11:22:19.738 GCD_Demo[26038:889213] blop1_1 start**</span><br><span class="line">**2016-03-31 11:22:19.738 GCD_Demo[26038:889226] blop1_2 start**</span><br><span class="line">**2016-03-31 11:22:19.738 GCD_Demo[26038:889213] ****线程****info : &lt;NSThread: 0x7fea3061d110&gt;&#123;number = 2, name = (null)&#125;**</span><br><span class="line">**2016-03-31 11:22:19.738 GCD_Demo[26038:889226] ****线程****info : &lt;NSThread: 0x7fea31800140&gt;&#123;number = 3, name = (null)&#125;**</span><br><span class="line">**2016-03-31 11:22:21.808 GCD_Demo[26038:889213] blop1_1 end**</span><br><span class="line">**2016-03-31 11:22:23.784 GCD_Demo[26038:889226] blop1_2 end**</span><br><span class="line"># 从输出的信息可以看出来，当设置最大的operation为1的时候，相当于这个队列同步运行了，不过这个同步的单位不是线程，而是operation。</span><br><span class="line"></span><br><span class="line">当把这两句代码加到 test5最后边输出结果是：</span><br><span class="line">**2016-03-31 11:28:59.267 GCD_Demo[26113:892737] op1 ****开始运行了**</span><br><span class="line">**2016-03-31 11:29:02.341 GCD_Demo[26113:892737] op1 ****结束**</span><br><span class="line">从输出结果得出：正在执行的Operation无法stop，正在ready的operation直接跳过start，执行complateBlock.状态由ready改为canceld。ps：注意看官方文档</span><br><span class="line">`Canceling the operations does not automatically remove them from the queue or stop those that are currently executing.`</span><br><span class="line">正在执行的不会从队列中删除也不会stop。</span><br><span class="line">`For operations that are queued and waiting execution, the queue must still attempt to execute the operation before recognizing that it is canceled and moving it to the finished state. </span><br><span class="line">For operations that are already executing, the operation object itself must check for cancellation and stop what it is doing so that it can move to the finished state. </span><br><span class="line">In both cases, a finished (or canceled) operation is still given a chance to execute its completion block before it is removed from the queue.` </span><br><span class="line">正在队列中等待的operation执行的时候会检测是否被cancenld，如果状态是canceld，那么直接执行completion block 在它被队列删除的时候。</span><br></pre></td></tr></table></figure>
<h3 id="在子线程中耗时的操作完成了，那么该在主线程中更新UI"><a href="#在子线程中耗时的操作完成了，那么该在主线程中更新UI" class="headerlink" title="在子线程中耗时的操作完成了，那么该在主线程中更新UI"></a>在子线程中耗时的操作完成了，那么该在主线程中更新UI</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#将上面的test5 改成下面的代码</span><br><span class="line">- (void)test5&#123;</span><br><span class="line">    NSInvocationOperation * op1 =[[NSInvocationOperation alloc]initWithTarget:self selector:@selector(op1) object:nil];</span><br><span class="line">    NSOperationQueue * queue =[[NSOperationQueue alloc]init];</span><br><span class="line">    [queue addOperation:op1];</span><br><span class="line">    queue.maxConcurrentOperationCount = 3;//根据需要设置数量</span><br><span class="line">    NSBlockOperation *block = [self test4];</span><br><span class="line">    [queue addOperation:block];</span><br><span class="line">//这句话一定要添加，这句话的意思等到所有的operation都完成了在执行后面的代码，</span><br><span class="line">其实就是上面的操作执行到这里要等待他们直到他们都完成了。</span><br><span class="line">#     [queue waitUntilAllOperationsAreFinished]; </span><br><span class="line">    NSBlockOperation * blockUpdateMainUI=[NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">        NSLog(@&quot;update UI&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line">    [[NSOperationQueue mainQueue] addOperation:blockUpdateMainUI];//在主队列中执行更新UI的操作</span><br><span class="line">&#125;</span><br><span class="line">上面的代码 和GCD中的分组有些类似，但是 这个OperationQueue基本单位是operation而不是线程，一定要理解。</span><br><span class="line">operation和线程的关系是 一个operation可能对应多个线程，也可能对应一个线程。</span><br></pre></td></tr></table></figure>
<p>关于NSOperationQueue的了解和使用我想到的基本就这么多场景，后期有其他的场景再补充。<br>预告：下期节目是NSThread的介绍和使用。<br>ps:广告时间</p>
<hr>
<p>有问题可以发我邮箱讨论共同交流技术。<br>fgyong@yeah.net</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fgyong.cn/2016/03/28/iOS线程之GCD初探/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fgyong">
      <meta itemprop="description" content="在学习的路上，不忘初心 方得始终">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fgyong的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/03/28/iOS线程之GCD初探/" class="post-title-link" itemprop="http://fgyong.cn/page/4/index.html">iOS线程之GCD初探</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-03-28 17:47:47" itemprop="dateCreated datePublished" datetime="2016-03-28T17:47:47+08:00">2016-03-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-03 16:24:13" itemprop="dateModified" datetime="2020-09-03T16:24:13+08:00">2020-09-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>简述：<br>       说道线程，离不开并行和串行，所谓并行，就是100赛跑，每个赛道就是一个线程，每个线程之间互不影响，同时都可以运行事件，就是10个赛道都可以有运动员跑步了，谁跑的慢或者跑的快，都不影响其他的人。串行就不一样了，串行是1个赛道10个运动员再跑接力赛，第一个跑到终点第二个在接着跑，依次类推，前边的不走，后边的也走不了的，所以串行上面的事件是一个一个运行的，同时只能是一个人再跑。</p>
<p>在iOS或者OS里面，一般用GCD就能吃处理较多的事务，下面就谈一下GCD的用法。</p>
<h3 id="什么是GCD？"><a href="#什么是GCD？" class="headerlink" title="什么是GCD？"></a>什么是GCD？</h3><p>全称是Grand Central Dispatch，可译为“牛逼的中枢调度器”<br>纯C语言，提供了非常多强大的函数</p>
<h3 id="methodList-info"><a href="#methodList-info" class="headerlink" title="methodList info"></a>methodList info</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取主线程 就是更新UI的线程</span><br><span class="line">dispatch_queue_t dispatch_get_main_queue(void);</span><br><span class="line"></span><br><span class="line"> //获取全局队列</span><br><span class="line">dispatch_queue_t dispatch_get_global_queue( long identifier, unsigned long flags);</span><br><span class="line"></span><br><span class="line">//创建一个队列 名字是label 属性可以写为NULL  </span><br><span class="line">dispatch_queue_t dispatch_queue_create( const char *label dispatch_queue_attr_t attr);</span><br><span class="line">dispatch_release(queue)//释放队列</span><br><span class="line"></span><br><span class="line">//获取代码现在运行的queue</span><br><span class="line">dispatch_queue_t dispatch_get_current_queue( void);</span><br><span class="line"></span><br><span class="line"> //获取队列的名字</span><br><span class="line">const char * dispatch_queue_get_label(dispatch_queue_t queue);</span><br><span class="line"></span><br><span class="line">//异步把代码块block交给queue队列中处理</span><br><span class="line">dispatch_async(dispatch_queue_t queue, dispatch_block_t block);</span><br><span class="line"></span><br><span class="line">// 同步将block加入到queue中并且执行。</span><br><span class="line">void dispatch_sync( dispatch_queue_t queue, dispatch_block_t block);</span><br><span class="line"></span><br><span class="line"> //block 在指定时间在queue中执行</span><br><span class="line">void dispatch_after( dispatch_time_t when, dispatch_queue_t queue, dispatch_block_t block);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">//几个调度事件同事加入到queue中去，最好是全局队列才行。</span><br><span class="line">void dispatch_apply( size_t iterations, dispatch_queue_t queue, void (^block)( size_t));</span><br><span class="line"></span><br><span class="line">// block 是否执行过</span><br><span class="line">void dispatch_once( dispatch_once_t *predicate, dispatch_block_t block);</span><br><span class="line"> </span><br><span class="line">//在分组group中的queue队列执行block</span><br><span class="line">void dispatch_group_async( dispatch_group_t group, dispatch_queue_t queue, dispatch_block_t block);</span><br><span class="line"></span><br><span class="line">//创建线程分组</span><br><span class="line">dispatch_group_t dispatch_group_create( void);</span><br><span class="line"></span><br><span class="line"> //分组的计数+1</span><br><span class="line">void dispatch_group_enter( dispatch_group_t group);</span><br><span class="line"></span><br><span class="line">//分组计数 -1</span><br><span class="line">void dispatch_group_leave( dispatch_group_t group);</span><br><span class="line"></span><br><span class="line">// 当分组中的事务处理完了执行block</span><br><span class="line">void dispatch_group_notify( dispatch_group_t group, dispatch_queue_t queue, dispatch_block_t block);</span><br><span class="line"></span><br><span class="line">//等待timeout时间后执行 group中的事务</span><br><span class="line">long dispatch_group_wait( dispatch_group_t group, dispatch_time_t timeout);</span><br><span class="line"></span><br><span class="line"> //并行状态下 queue前面的并行事务处理完成了在执行block，然后执行下边的并行代码</span><br><span class="line">//比如 ABCDEF D事务等到ABC都完成了在执行EF事务的</span><br><span class="line">void dispatch_barrier_async( dispatch_queue_t queue, dispatch_block_t block);</span><br></pre></td></tr></table></figure>
<h3 id="实战演练全局队列"><a href="#实战演练全局队列" class="headerlink" title="实战演练全局队列"></a>实战演练全局队列</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</span><br><span class="line"></span><br><span class="line">dispatch_async(queue, ^&#123;</span><br><span class="line">        //异步执行</span><br><span class="line">        dispatch_sync(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            //这里面更新UI</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_sync(queue, ^&#123;</span><br><span class="line">       //同步执行</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="自定义队列"><a href="#自定义队列" class="headerlink" title="自定义队列"></a>自定义队列</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t queue = dispatch_queue_create(&quot;com.apple.fgyong&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    //</span><br><span class="line">//#define DISPATCH_QUEUE_SERIAL   同步队列</span><br><span class="line">//#define DISPATCH_QUEUE_CONCURRENT 异步队列</span><br><span class="line">    dispatch_async(queue, ^&#123;</span><br><span class="line">        NSLog(@&quot;下载图片1=====%@&quot;,[NSThread currentThread]);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(queue, ^&#123;</span><br><span class="line">        NSLog(@&quot;下载图片2=====%@&quot;,[NSThread currentThread]);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(queue, ^&#123;</span><br><span class="line">        NSLog(@&quot;下载图片3=====%@&quot;,[NSThread currentThread]);</span><br><span class="line">    &#125;);</span><br><span class="line">    NSLog(@&quot;main:%@&quot;,[NSThread mainThread]);</span><br><span class="line">当queue属性为 DISPATCH_QUEUE_CONCURRENT输出：</span><br><span class="line">**2016-03-28 16:53:25.848 GCD_Demo[12338:347984] ****下载图片****3=====&lt;NSThread: 0x7fabda100250&gt;&#123;number = 4, name = (null)&#125;**</span><br><span class="line">**2016-03-28 16:53:25.848 GCD_Demo[12338:347982] ****下载图片****2=====&lt;NSThread: 0x7fabda2008a0&gt;&#123;number = 3, name = (null)&#125;**</span><br><span class="line">**2016-03-28 16:53:25.848 GCD_Demo[12338:347937] main:&lt;NSThread: 0x7fabd8c04ee0&gt;&#123;number = 1, name = main&#125;**</span><br><span class="line">**2016-03-28 16:53:25.848 GCD_Demo[12338:347981] ****下载图片****1=====&lt;NSThread: 0x7fabd8c0a010&gt;&#123;number = 2, name = (null)&#125;** 线程达到了4个</span><br><span class="line">当queue属性为DISPATCH_QUEUE_SERIAL输出：</span><br><span class="line">**2016-03-28 16:46:54.501 GCD_Demo[12272:344348] main:&lt;NSThread: 0x7fd379704cf0&gt;&#123;number = 1, name = main&#125;**</span><br><span class="line">**2016-03-28 16:46:54.501 GCD_Demo[12272:344382] ****下载图片****1=====&lt;NSThread: 0x7fd37971bda0&gt;&#123;number = 2, name = (null)&#125;**</span><br><span class="line">**2016-03-28 16:46:54.502 GCD_Demo[12272:344382] ****下载图片****2=====&lt;NSThread: 0x7fd37971bda0&gt;&#123;number = 2, name = (null)&#125;**</span><br><span class="line">**2016-03-28 16:46:54.502 GCD_Demo[12272:344382] ****下载图片****3=====&lt;NSThread: 0x7fd37971bda0&gt;&#123;number = 2, name = (null)&#125;**</span><br><span class="line">线程只有2个</span><br></pre></td></tr></table></figure>
<h3 id="多个异步线程问题"><a href="#多个异步线程问题" class="headerlink" title="多个异步线程问题"></a>多个异步线程问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># 当ABC 3个异步线程，要求前两个个执行完再去执行后面的三个的时候例子：</span><br><span class="line">     dispatch_queue_t queue = dispatch_queue_create(&quot;com.apple.fgyong&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"></span><br><span class="line">    dispatch_async(queue, ^&#123;</span><br><span class="line">        NSLog(@&quot;queue1 begin&quot;);</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;queue1 end&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(queue, ^&#123;</span><br><span class="line">        NSLog(@&quot;queue2 begin&quot;);</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;queue2 end&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_barrier_sync(queue, ^&#123;</span><br><span class="line">        NSLog(@&quot;main:%@&quot;,[NSThread mainThread]);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_async(queue, ^&#123;</span><br><span class="line">        NSLog(@&quot;queue3 begin&quot;);</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;queue3 end&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">输出：</span><br><span class="line"></span><br><span class="line">**2016-03-28 17:01:01.319 GCD_Demo[12463:353702] queue2 begin**</span><br><span class="line">**2016-03-28 17:01:01.319 GCD_Demo[12463:353703] queue1 begin**</span><br><span class="line">**2016-03-28 17:01:03.324 GCD_Demo[12463:353703] queue1 end**</span><br><span class="line">**2016-03-28 17:01:03.324 GCD_Demo[12463:353702] queue2 end**</span><br><span class="line">**2016-03-28 17:01:03.325 GCD_Demo[12463:353657] main:&lt;NSThread: 0x7f97ea604bf0&gt;&#123;number = 1, name = main&#125;**</span><br><span class="line">**2016-03-28 17:01:03.325 GCD_Demo[12463:353702] queue3 begin**</span><br><span class="line">**2016-03-28 17:01:05.330 GCD_Demo[12463:353702] queue3 end**</span><br></pre></td></tr></table></figure>
<h3 id="线程分组"><a href="#线程分组" class="headerlink" title="线程分组"></a>线程分组</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"># 当多个任务同时进行的时候，也可以用group，ABCD任务进行完成的时候，最后在执行task。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  dispatch_queue_t queue = dispatch_queue_create(&quot;com.apple.fgyong&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;task1 begin&quot;);</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;task1 end&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;task2 begin&quot;);</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;task2 end&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_group_notify(group, queue, ^&#123;</span><br><span class="line">        NSLog(@&quot;=================&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;task3 begin&quot;);</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;task3 end&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;task4 begin&quot;);</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;task4 end&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">输出：</span><br><span class="line">**2016-03-28 17:08:45.002 GCD_Demo[12557:357162] task1 begin**</span><br><span class="line">**2016-03-28 17:08:45.002 GCD_Demo[12557:357164] task4 begin**</span><br><span class="line">**2016-03-28 17:08:45.002 GCD_Demo[12557:357161] task2 begin**</span><br><span class="line">**2016-03-28 17:08:45.002 GCD_Demo[12557:357163] task3 begin**</span><br><span class="line">**2016-03-28 17:08:47.005 GCD_Demo[12557:357162] task1 end**</span><br><span class="line">**2016-03-28 17:08:47.005 GCD_Demo[12557:357163] task3 end**</span><br><span class="line">**2016-03-28 17:08:47.005 GCD_Demo[12557:357164] task4 end**</span><br><span class="line">**2016-03-28 17:08:47.005 GCD_Demo[12557:357161] task2 end**</span><br><span class="line">**2016-03-28 17:08:47.006 GCD_Demo[12557:357161] =================**</span><br><span class="line">一个组内的所有任务都进行完了才会执行task的函数。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 分组多任务等待 ABCDEF ，ABCD执行5秒，5秒之后就执行EF任务，不管ABCD是否成功。</span><br><span class="line"></span><br><span class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;com.apple.fgyong&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;task1 begin&quot;);</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;task1 end&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;task2 begin&quot;);</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;task2 end&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_group_notify(group, queue, ^&#123;</span><br><span class="line">        NSLog(@&quot;=================&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;task3 begin&quot;);</span><br><span class="line">        sleep(6);</span><br><span class="line">        NSLog(@&quot;task3 end&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">    dispatch_group_wait(group, dispatch_time(DISPATCH_TIME_NOW, (int64_t)(5*NSEC_PER_SEC)));</span><br><span class="line">    NSLog(@&quot;all end&quot;);</span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;task4 begin&quot;);</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSLog(@&quot;task4 end&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">输出：</span><br><span class="line"># 代码执行到wait的时候会等待5秒之后再执行wait下边的代码，和sleep有点相似。</span><br><span class="line">**2016-03-28 17:26:31.335 GCD_Demo[12745:366983] task3 begin**</span><br><span class="line">**2016-03-28 17:26:31.335 GCD_Demo[12745:366978] task1 begin**</span><br><span class="line">**2016-03-28 17:26:31.335 GCD_Demo[12745:366979] task2 begin**</span><br><span class="line">**2016-03-28 17:26:33.340 GCD_Demo[12745:366978] task1 end**</span><br><span class="line">**2016-03-28 17:26:33.340 GCD_Demo[12745:366979] task2 end**</span><br><span class="line">**2016-03-28 17:26:36.336 GCD_Demo[12745:366894] all end**</span><br><span class="line">**2016-03-28 17:26:36.336 GCD_Demo[12745:366979] task4 begin**</span><br><span class="line">**2016-03-28 17:26:37.340 GCD_Demo[12745:366983] task3 end**</span><br><span class="line">**2016-03-28 17:26:38.342 GCD_Demo[12745:366979] task4 end**</span><br><span class="line">**2016-03-28 17:26:38.342 GCD_Demo[12745:366983] =================**</span><br></pre></td></tr></table></figure>
<h3 id="同时处理多数据不管顺序"><a href="#同时处理多数据不管顺序" class="headerlink" title="同时处理多数据不管顺序"></a>同时处理多数据不管顺序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">          dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">          /*! dispatch_apply函数说明</span><br><span class="line">           10      *</span><br><span class="line">           11      *  @brief  dispatch_apply函数是dispatch_sync函数和Dispatch Group的关联API</span><br><span class="line">           12      *         该函数按指定的次数将指定的Block追加到指定的Dispatch Queue中,并等到全部的处理执行结束</span><br><span class="line">           13      *</span><br><span class="line">           14      *  @param 10    指定重复次数  指定10次</span><br><span class="line">           15      *  @param queue 追加对象的Dispatch Queue</span><br><span class="line">           16      *  @param index 带有参数的Block, index的作用是为了按执行的顺序区分各个Block</span><br><span class="line">           17      *</span><br><span class="line">           18      */</span><br><span class="line">          dispatch_apply(10, queue, ^(size_t index) &#123;</span><br><span class="line">                  NSLog(@&quot;%d&quot;, index);</span><br><span class="line">              </span><br><span class="line">              &#125;);</span><br><span class="line">          NSLog(@&quot;done&quot;);</span><br><span class="line">输出：</span><br><span class="line"># 这个和上边讲的分组类似，多事务处理，处理结束后再执行代码。</span><br><span class="line"># 这个是同步的，代码按顺序执行，分组的是异步执行的block</span><br><span class="line">**2016-03-28 17:36:35.698 GCD_Demo[12857:372458] 1**</span><br><span class="line">**2016-03-28 17:36:35.698 GCD_Demo[12857:372463] 5**</span><br><span class="line">**2016-03-28 17:36:35.698 GCD_Demo[12857:372429] 4**</span><br><span class="line">**2016-03-28 17:36:35.698 GCD_Demo[12857:372464] 6**</span><br><span class="line">**2016-03-28 17:36:35.698 GCD_Demo[12857:372465] 7**</span><br><span class="line">**2016-03-28 17:36:35.698 GCD_Demo[12857:372462] 2**</span><br><span class="line">**2016-03-28 17:36:35.698 GCD_Demo[12857:372457] 0**</span><br><span class="line">**2016-03-28 17:36:35.698 GCD_Demo[12857:372461] 3**</span><br><span class="line">**2016-03-28 17:36:35.699 GCD_Demo[12857:372458] 8**</span><br><span class="line">**2016-03-28 17:36:35.699 GCD_Demo[12857:372429] 9**</span><br><span class="line">**2016-03-28 17:36:35.699 GCD_Demo[12857:372429] done**</span><br></pre></td></tr></table></figure>
<p>参考文章：<a href="https://developer.apple.com/library/ios/documentation/Performance/Reference/GCD_libdispatch_Ref/index.html#//apple_ref/c/macro/DISPATCH_QUEUE_CONCURRENT" target="_blank" rel="noopener">Grand Central Dispatch (GCD) Reference</a><br>GCD提供的接口蛮多的,适用场景还是要熟练掌握，才能运用自如。</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fgyong.cn/2016/03/28/iOS高级开发runtime那点事实战（4）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fgyong">
      <meta itemprop="description" content="在学习的路上，不忘初心 方得始终">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fgyong的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/03/28/iOS高级开发runtime那点事实战（4）/" class="post-title-link" itemprop="http://fgyong.cn/page/4/index.html">iOS高级开发runtime那点事实战（4）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-03-28 14:19:20" itemprop="dateCreated datePublished" datetime="2016-03-28T14:19:20+08:00">2016-03-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-03 16:24:13" itemprop="dateModified" datetime="2020-09-03T16:24:13+08:00">2020-09-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Category"><a href="#Category" class="headerlink" title="Category"></a>Category</h3><p>Category是表示一个指向分类的结构体的指针，其定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">typedef struct objc_category *Category;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">struct objc_category &#123;</span><br><span class="line"></span><br><span class="line">    char *category_name                          OBJC2_UNAVAILABLE; // 分类名</span><br><span class="line"></span><br><span class="line">    char *class_name                             OBJC2_UNAVAILABLE; // 分类所属的类名</span><br><span class="line"></span><br><span class="line">    struct objc_method_list *instance_methods    OBJC2_UNAVAILABLE; // 实例方法列表</span><br><span class="line"></span><br><span class="line">    struct objc_method_list *class_methods       OBJC2_UNAVAILABLE; // 类方法列表</span><br><span class="line"></span><br><span class="line">    struct objc_protocol_list *protocols         OBJC2_UNAVAILABLE; // 分类所实现的协议列表</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Protocol"><a href="#Protocol" class="headerlink" title="Protocol"></a>Protocol</h3><p>Protocol定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">typedef struct objc_object Protocol;</span><br><span class="line"></span><br><span class="line">// 返回指定的协议</span><br><span class="line"></span><br><span class="line">Protocol * objc_getProtocol ( const char *name );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 获取运行时所知道的所有协议的数组</span><br><span class="line"></span><br><span class="line">Protocol ** objc_copyProtocolList ( unsigned int *outCount );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 创建新的协议实例</span><br><span class="line"></span><br><span class="line">Protocol * objc_allocateProtocol ( const char *name );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 在运行时中注册新创建的协议</span><br><span class="line"></span><br><span class="line">void objc_registerProtocol ( Protocol *proto );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 为协议添加方法</span><br><span class="line"></span><br><span class="line">void protocol_addMethodDescription ( Protocol *proto, SEL name, const char *types, BOOL isRequiredMethod, BOOL isInstanceMethod );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 添加一个已注册的协议到协议中</span><br><span class="line"></span><br><span class="line">void protocol_addProtocol ( Protocol *proto, Protocol *addition );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 为协议添加属性</span><br><span class="line"></span><br><span class="line">void protocol_addProperty ( Protocol *proto, const char *name, const objc_property_attribute_t *attributes, unsigned int attributeCount, BOOL isRequiredProperty, BOOL isInstanceProperty );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 返回协议名</span><br><span class="line"></span><br><span class="line">const char * protocol_getName ( Protocol *p );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 测试两个协议是否相等</span><br><span class="line"></span><br><span class="line">BOOL protocol_isEqual ( Protocol *proto, Protocol *other );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 获取协议中指定条件的方法的方法描述数组</span><br><span class="line"></span><br><span class="line">struct objc_method_description * protocol_copyMethodDescriptionList ( Protocol *p, BOOL isRequiredMethod, BOOL isInstanceMethod, unsigned int *outCount );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 获取协议中指定方法的方法描述</span><br><span class="line"></span><br><span class="line">struct objc_method_description protocol_getMethodDescription ( Protocol *p, SEL aSel, BOOL isRequiredMethod, BOOL isInstanceMethod );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 获取协议中的属性列表</span><br><span class="line"></span><br><span class="line">objc_property_t * protocol_copyPropertyList ( Protocol *proto, unsigned int *outCount );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 获取协议的指定属性</span><br><span class="line"></span><br><span class="line">objc_property_t protocol_getProperty ( Protocol *proto, const char *name, BOOL isRequiredProperty, BOOL isInstanceProperty );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 获取协议采用的协议</span><br><span class="line"></span><br><span class="line">Protocol ** protocol_copyProtocolList ( Protocol *proto, unsigned int *outCount );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 查看协议是否采用了另一个协议</span><br><span class="line"></span><br><span class="line">BOOL protocol_conformsToProtocol ( Protocol *proto, Protocol *other );</span><br></pre></td></tr></table></figure>
<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">const char *property_getName(objc_property_t property) 获得property的name</span><br><span class="line"></span><br><span class="line">const char *property_getAttributes(objc_property_t property) //获得property的atttibutes</span><br><span class="line"></span><br><span class="line">char *property_copyAttributeValue(objc_property_t property, const char *attributeName) 拷贝 property的attributeName的值</span><br><span class="line"></span><br><span class="line">objc_property_attribute_t *property_copyAttributeList(objc_property_t property, unsigned int*outCount) 拷贝property的数组 个数是outCount</span><br></pre></td></tr></table></figure>
<p>其实runtime的很多函数在平时我们是用不到的，但是还是要了解一点的，以便于有时候出现的问题，自己却不知道原理，那样解决问题，有时解决了但是还不知道为什么。<a href="http://www.opensource.apple.com/tarballs/objc4/" target="_blank" rel="noopener">至于runtime的源码在这里</a>,要下载就下载版本最高的，感兴趣的可以看一下。</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fgyong.cn/2016/03/24/iOS高级开发runtime那点事实战（3）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fgyong">
      <meta itemprop="description" content="在学习的路上，不忘初心 方得始终">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fgyong的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/03/24/iOS高级开发runtime那点事实战（3）/" class="post-title-link" itemprop="http://fgyong.cn/page/4/index.html">iOS高级开发runtime那点事实战（3）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-03-24 11:15:48" itemprop="dateCreated datePublished" datetime="2016-03-24T11:15:48+08:00">2016-03-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-03 16:24:13" itemprop="dateModified" datetime="2020-09-03T16:24:13+08:00">2020-09-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="添加类"><a href="#添加类" class="headerlink" title="添加类"></a>添加类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">objc_allocateClassPair(Class superclass, const char *name, size_t extraBytes)</span><br><span class="line">添加类 superclass 类是父类   name 类的名字  size_t 类占的空间</span><br><span class="line"></span><br><span class="line">void objc_disposeClassPair(Class cls) 销毁类</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void objc_registerClassPair(Class cls) 注册类</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">objc_duplicateClass</span><br><span class="line"> Used by Foundation&apos;s Key-Value Observing.官方说法是不让自己调用</span><br><span class="line">Do not call this function yourself.</span><br></pre></td></tr></table></figure>
<p>具体代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (void)allocClass&#123;</span><br><span class="line">    Class clas = objc_allocateClassPair(NSClassFromString(@&quot;FY&quot;), &quot;FYss&quot;, 0);</span><br><span class="line">   </span><br><span class="line">    objc_property_attribute_t type = &#123;&quot;T&quot;, &quot;@\&quot;NSString\&quot;&quot;&#125;;</span><br><span class="line">    objc_property_attribute_t ownership = &#123; &quot;C&quot;, &quot;&quot; &#125;;</span><br><span class="line">    objc_property_attribute_t backingivar = &#123; &quot;V&quot;, &quot;_ivar1&quot;&#125;;</span><br><span class="line">    objc_property_attribute_t attrs[] = &#123;type, ownership, backingivar&#125;;</span><br><span class="line"> </span><br><span class="line"> bool success =    class_addProperty(clas, &quot;nameIvar&quot;, attrs, 3);</span><br><span class="line">    if (success) &#123;</span><br><span class="line">        NSLog(@&quot;addIvar success&quot;);</span><br><span class="line">        if (class_isMetaClass(clas)) &#123;</span><br><span class="line">            NSLog(@&quot;是一个类&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     objc_registerClassPair(clas);</span><br><span class="line">    [self printPropreListClass:clas];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="实例化类"><a href="#实例化类" class="headerlink" title="实例化类"></a>实例化类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 创建类实例</span><br><span class="line"></span><br><span class="line">id class_createInstance ( Class cls, size_t extraBytes );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 在指定位置创建类实例</span><br><span class="line"></span><br><span class="line">id objc_constructInstance ( Class cls, void *bytes );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 销毁类实例</span><br><span class="line"></span><br><span class="line">void * objc_destructInstance ( id obj );</span><br></pre></td></tr></table></figure>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">id object_copy(id obj, size_t size) //拷贝obj</span><br><span class="line"></span><br><span class="line">id object_dispose(id obj)   //释放obj</span><br><span class="line"></span><br><span class="line">Ivar object_setInstanceVariable(id obj, const char *name, void *value) //修改实例的值</span><br><span class="line"></span><br><span class="line">Ivar object_getInstanceVariable(id obj, const char *name, void **outValue) //获取实例</span><br><span class="line"></span><br><span class="line">OBJC_EXPORT void *object_getIndexedIvars(id obj) //获取obj的index</span><br><span class="line"></span><br><span class="line">id object_getIvar(id object, Ivar ivar) //获取obj的ivar</span><br><span class="line"></span><br><span class="line">void object_setIvar(id object, Ivar ivar, id value) //赋值ivar给obj默认值是value</span><br><span class="line"></span><br><span class="line">const char *object_getClassName(id obj) //获取类的名字</span><br><span class="line"></span><br><span class="line">Class object_getClass(id object) //获得 类</span><br><span class="line"></span><br><span class="line">Class object_setClass(id object, Class cls)  //把obj 改到cls的类下</span><br><span class="line"></span><br><span class="line">int objc_getClassList(Class *buffer, int bufferLen) //获取class列表</span><br><span class="line"></span><br><span class="line">Class *objc_copyClassList(unsigned int *outCount) //拷贝类数组</span><br><span class="line"></span><br><span class="line">id objc_lookUpClass(const char *name) // 看看是否 注册了类</span><br><span class="line"></span><br><span class="line">id objc_getClass(const char *name) //获取类</span><br><span class="line"></span><br><span class="line">id objc_getRequiredClass(const char *name) //要是没有这个类就kill 这个类 </span><br><span class="line"></span><br><span class="line">const char * ivar_getName( Ivar ivar) //获取var的名字</span><br><span class="line"></span><br><span class="line">const char * ivar_getTypeEncoding( Ivar ivar) //获取ivar 的 type</span><br><span class="line"></span><br><span class="line">ptrdiff_t ivar_getOffset( Ivar ivar) //</span><br><span class="line"></span><br><span class="line">void objc_setAssociatedObject(id object, void *key, id value, objc_AssociationPolicy policy) //给类别添加 属性</span><br><span class="line"></span><br><span class="line">id objc_getAssociatedObject(id object, void *key) //获取属性</span><br><span class="line"></span><br><span class="line">void objc_removeAssociatedObjects(id object) //删除属性</span><br></pre></td></tr></table></figure>
<h3 id="发送消息"><a href="#发送消息" class="headerlink" title="发送消息"></a>发送消息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">id objc_msgSend(id self, SEL op, ...)// id 发送消息给SEL op</span><br><span class="line"></span><br><span class="line">double objc_msgSend_fpret(id self, SEL op, ...)// 和上边的一样这个用i386平台，PPC和PPC64不能用。</span><br><span class="line"></span><br><span class="line">void objc_msgSend_stret(void * stretAddr, id theReceiver, SEL theSelector, ...)// 有返回值的消息  stretAddr 是返回值 theReceiver接收消息的id SEL 是方法名</span><br><span class="line"></span><br><span class="line">id objc_msgSendSuper(struct objc_super *super, SEL op, ...)//给父类方法发送消息</span><br><span class="line"></span><br><span class="line">void objc_msgSendSuper_stret(struct objc_super *super, SEL op, ...)//给父类添加消息</span><br></pre></td></tr></table></figure>
<p>当我们用OC调用方法的时候，其实底层是obj发送消息的过程，就够obj发送消息给SEL，然后objruntime中会在objSELList中寻找，当然不是每次都去遍历所有的方法的，而是在methodCache，它会先去常用的方法cache在中查找，要是cache中没有这个方法，再去遍历所有的方法。参考：<a href="http://www.opensource.apple.com/tarballs/objc4/" target="_blank" rel="noopener">Runtime源码点这里</a></p>
<h3 id="具体测试"><a href="#具体测试" class="headerlink" title="具体测试"></a>具体测试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    objc_msgSend(self,@selector(msgTest));</span><br><span class="line"></span><br><span class="line">-(void)msgTest&#123;</span><br><span class="line">    NSLog(@&quot;调用了我 objc_msgSend&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出：2016-03-23 15:06:18.011 runTimeObj[46084:3861049] 调用了我 objc_msgSend</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">id method_invoke(id receiver, Method m, ...) 调用receiver的方法 id 不能是nil</span><br><span class="line"></span><br><span class="line">void method_invoke_stret(id receiver, Method m, ...) //Using this function to call the implementation of a method is faster than calling method_getImplementation and method_getName. 官方描述就是比method_getName和method_getImplementation块</span><br><span class="line"></span><br><span class="line">IMP method_getImplementation( Method method) //指向IMP的方法指针</span><br><span class="line">IMP是什么？本质上是一个指针，指向方法的指针，俗名就是函数指针。</span><br><span class="line"></span><br><span class="line">const char * method_getTypeEncoding( Method method) //方法type 返回一个c字符串</span><br><span class="line"></span><br><span class="line">char * method_copyReturnType( Method method) 方法返回的类型 一个c字符串 用完要free(char *)的</span><br><span class="line"></span><br><span class="line">unsigned method_getNumberOfArguments( Method method) //方法的元素数量</span><br><span class="line"></span><br><span class="line">void method_getArgumentType( Method method, unsigned int index, char *dst, size_t dst_len) 获取method 索引是index的参数 值赋给dst 要是dst = nil；系统自动调用strncpy(dst, &quot;&quot;, dst_len)</span><br><span class="line"></span><br><span class="line">IMP method_setImplementation( Method method, IMP imp) 把imp赋给method </span><br><span class="line"></span><br><span class="line">void method_exchangeImplementations( Method m1, Method m2) 交换两个方法</span><br><span class="line">例如：IMP imp1 = method_getImplementation(m1);</span><br><span class="line">     IMP imp2 = method_getImplementation(m2);</span><br><span class="line">         method_setImplementation(m1, imp2);</span><br><span class="line">         method_setImplementation(m2, imp1);</span><br><span class="line">const char * * objc_copyImageNames(unsigned int *outCount)//返回所有加载的Objective-C框架和动态库的名字。</span><br><span class="line"></span><br><span class="line">const char *class_getImageName(Class cls)//获取class的动态库的名字</span><br><span class="line"></span><br><span class="line">const char * *objc_copyClassNamesForImage(const char *image, unsigned int *outCount) //拷贝动态库</span><br><span class="line"></span><br><span class="line">const char* sel_getName(SEL aSelector) //获取SEL的字符串名字</span><br><span class="line"></span><br><span class="line">SEL sel_registerName(const char *str) //注册SEL 名字是str 返回注册成功的SEL</span><br><span class="line"></span><br><span class="line">SEL sel_getUid(const char *str) //获取str的方法SEL指针</span><br><span class="line"></span><br><span class="line">BOOL sel_isEqual(SEL lhs, SEL rhs) //判断两个SEL是否是同一个SEL</span><br></pre></td></tr></table></figure>
<p>今天就到这吧，明天吧协议和属性看了。更多文章在www.fgyong.cn</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fgyong.cn/2016/03/24/iOS高级开发runtime那点事实战（2）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fgyong">
      <meta itemprop="description" content="在学习的路上，不忘初心 方得始终">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fgyong的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/03/24/iOS高级开发runtime那点事实战（2）/" class="post-title-link" itemprop="http://fgyong.cn/page/4/index.html">iOS高级开发runtime那点事实战（2）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-03-24 11:01:56" itemprop="dateCreated datePublished" datetime="2016-03-24T11:01:56+08:00">2016-03-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-03 16:24:13" itemprop="dateModified" datetime="2020-09-03T16:24:13+08:00">2020-09-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="获取class的property属性List"><a href="#获取class的property属性List" class="headerlink" title="获取class的property属性List"></a>获取class的property属性List</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-(void)printPropertyList&#123;</span><br><span class="line">    unsigned int count ;//存储属性的数量的</span><br><span class="line">    objc_property_t * methodsVar = class_copyPropertyList([UINavigationController class], &amp;count) ;</span><br><span class="line">    for (int i = 0; i &lt; count; i ++) &#123;</span><br><span class="line">        objc_property_t var = methodsVar[i] ;</span><br><span class="line">        NSString * strName =[NSString stringWithUTF8String:property_getName(var)];</span><br><span class="line">        NSString * str =[NSString stringWithUTF8String:property_getAttributes(var)];</span><br><span class="line">        NSLog(@&quot;属性 %@   名字  %@&quot;,str,strName);</span><br><span class="line">    &#125;</span><br><span class="line">    free(methodsVar);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取class的的名字"><a href="#获取class的的名字" class="headerlink" title="获取class的的名字"></a>获取class的的名字</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-(void)printfClassName&#123;</span><br><span class="line">    Class clas = NSClassFromString(@&quot;NSString&quot;);</span><br><span class="line">   printf(&quot;%s&quot;, class_getName(clas)); //当clas为空的话 return value 是nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出：NSString</span><br></pre></td></tr></table></figure>
<h3 id="获取类的父类并输出"><a href="#获取类的父类并输出" class="headerlink" title="获取类的父类并输出"></a>获取类的父类并输出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-(void)printfClassName:(Class )clas&#123;</span><br><span class="line">   printf(&quot;%s&quot;, class_getName(clas));</span><br><span class="line">&#125;</span><br><span class="line">-(Class)getSuperClass:(Class)clas&#123;</span><br><span class="line">    return class_getSuperclass(clas);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[self printfClassName:[self getSuperClass:NSClassFromString(@&quot;UIView&quot;)]];</span><br><span class="line">输出：UIResponder</span><br></pre></td></tr></table></figure>
<h3 id="设置类的父类"><a href="#设置类的父类" class="headerlink" title="设置类的父类"></a>设置类的父类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/** </span><br><span class="line"> * Sets the superclass of a given class.</span><br><span class="line"> * </span><br><span class="line"> * @param cls The class whose superclass you want to set.</span><br><span class="line"> * @param newSuper The new superclass for cls.</span><br><span class="line"> * </span><br><span class="line"> * @return The old superclass for cls.</span><br><span class="line"> * </span><br><span class="line"> * @warning You should not use this function. 警告不要用</span><br><span class="line"> */</span><br><span class="line">OBJC_EXPORT Class class_setSuperclass(Class cls, Class newSuper) </span><br><span class="line">     __OSX_AVAILABLE_BUT_DEPRECATED(__MAC_10_5,__MAC_10_5, __IPHONE_2_0,__IPHONE_2_0);</span><br><span class="line">     </span><br><span class="line">    [self printfClassName:[self getSuperClass:NSClassFromString(@&quot;FY&quot;)]];第一次输出NSObjec</span><br><span class="line">    [self setClass:NSClassFromString(@&quot;FY&quot;) newSuperClass:NSClassFromString(@&quot;UIImageView&quot;)];//设置新的父类</span><br><span class="line">    [self printfClassName:[self getSuperClass:NSClassFromString(@&quot;FY&quot;)]];//再次输出是UIImageView 说明设置新的父类是可用的</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">-(void)printfClassName:(Class )clas&#123;</span><br><span class="line">   printf(&quot;%s\n&quot;, class_getName(clas));</span><br><span class="line">&#125;</span><br><span class="line">-(Class)getSuperClass:(Class)clas&#123;</span><br><span class="line">    return class_getSuperclass(clas);</span><br><span class="line">&#125;</span><br><span class="line">-(Class)setClass:(Class)clas newSuperClass:(Class)superClas&#123;</span><br><span class="line">   return   class_setSuperclass(clas, superClas);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="对象和类的区分"><a href="#对象和类的区分" class="headerlink" title="对象和类的区分"></a>对象和类的区分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">-(void)isMetaClass&#123;</span><br><span class="line">    NSMutableArray *arr = [[NSMutableArray alloc] init];</span><br><span class="line">    </span><br><span class="line">    [arr addObject:[NSObject class]];</span><br><span class="line">    [arr addObject:[NSValue class]];</span><br><span class="line">    [arr addObject:[NSNumber class]];</span><br><span class="line">    [arr addObject:[NSPredicate class]];</span><br><span class="line">    [arr addObject:@&quot;not a class object&quot;];</span><br><span class="line">    </span><br><span class="line">    for (int i; i&lt;[arr count]; i++) &#123;</span><br><span class="line">        id obj = [arr objectAtIndex:i];</span><br><span class="line">        </span><br><span class="line">        if(class_isMetaClass(object_getClass(obj)))</span><br><span class="line">        &#123;</span><br><span class="line">            //do sth</span><br><span class="line">            NSLog(@&quot;Class: %@&quot;, obj);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            NSLog(@&quot;Instance: %@&quot;, obj);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出：2016-03-18 15:46:56.235 runTimeObj[18396:2997316] Class: NSObject</span><br><span class="line">2016-03-18 15:46:56.236 runTimeObj[18396:2997316] Class: NSValue</span><br><span class="line">2016-03-18 15:46:56.236 runTimeObj[18396:2997316] Class: NSNumber</span><br><span class="line">2016-03-18 15:46:56.236 runTimeObj[18396:2997316] Class: NSPredicate</span><br><span class="line">2016-03-18 15:46:56.236 runTimeObj[18396:2997316] Instance: not a class object</span><br></pre></td></tr></table></figure>
<h3 id="获得类所占字节的大小"><a href="#获得类所占字节的大小" class="headerlink" title="获得类所占字节的大小"></a>获得类所占字节的大小</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">size_t size = class_getInstanceSize(NSClassFromString(@&quot;UIView&quot;));</span><br><span class="line">    printf(&quot;%zu&quot;,size);</span><br></pre></td></tr></table></figure>
<h3 id="获得类的属性及其属性的类型"><a href="#获得类的属性及其属性的类型" class="headerlink" title="获得类的属性及其属性的类型"></a>获得类的属性及其属性的类型</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">-(void)ivarList&#123;</span><br><span class="line">    unsigned int count;</span><br><span class="line">    Ivar * vars = class_copyIvarList(NSClassFromString(@&quot;UIViewController&quot;), &amp;count)//ivar 是结构体 包含 name,offset,type三个可读属性的结构体。</span><br><span class="line">    ;</span><br><span class="line">    for (int i = 0; i &lt; count; i ++) &#123;</span><br><span class="line">        Ivar  var = vars[i];</span><br><span class="line">        [self printIvar:var];</span><br><span class="line">    &#125;</span><br><span class="line">    free(vars);</span><br><span class="line">&#125;</span><br><span class="line">-(void)printIvar:(Ivar)var&#123;//输出结构体</span><br><span class="line">    const  char * name = ivar_getName(var);</span><br><span class="line">    long  offset = ivar_getOffset(var);</span><br><span class="line">    const  char * type = ivar_getTypeEncoding(var);</span><br><span class="line">    printf(&quot;%s %ld %s\n&quot;,name,offset,type);</span><br><span class="line">&#125;</span><br><span class="line">输出：</span><br><span class="line">_storyboard 152 @&quot;UIStoryboard&quot;</span><br><span class="line">_externalObjectsTableForViewLoading 160 @&quot;NSDictionary&quot;</span><br><span class="line">_topLevelObjectsToKeepAliveFromStoryboard 168 @&quot;NSArray&quot;</span><br><span class="line">_savedHeaderSuperview 176 @&quot;UIView&quot;</span><br><span class="line">_savedFooterSuperview 184 @&quot;UIView&quot;</span><br></pre></td></tr></table></figure>
<p>这些是apple <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/ObjCRuntimeRef/index.html#//apple_ref/c/func/objc_msgSend" target="_blank" rel="noopener">Objectice-C Runtime Reference</a>,具体的更多的在这个网址可见。</p>
<p>上一篇说了一个方法 名字是<code>void method_exchangeImplementations(Method m1, Method m2)</code><br>因为这个交换方法只能执行一次，所以解决了交换两次，就相当于没有交换了。具体代码：</p>
<pre><code>static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{

        void (^__method_swizzling)(Class, SEL, SEL) = ^(Class cls, SEL sel, SEL _sel) {
            Method  method = class_getInstanceMethod(cls, sel);
            Method _method = class_getInstanceMethod(cls, _sel);
            method_exchangeImplementations(method, _method);
        };
      }
</code></pre><p>在这里是把这个方法封装了一个c函数，保证了只会执行一次，最好把这个<code>dispatch</code>放在<code>+ load</code>函数里面，保证加载次数的减少。<br>更多博客在www.fgyong.cn可见。</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fgyong.cn/2016/03/24/iOS高级开发runtime那点事实战（1）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fgyong">
      <meta itemprop="description" content="在学习的路上，不忘初心 方得始终">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fgyong的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/03/24/iOS高级开发runtime那点事实战（1）/" class="post-title-link" itemprop="http://fgyong.cn/page/4/index.html">iOS高级开发runtime那点事实战（1）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-03-24 10:36:14" itemprop="dateCreated datePublished" datetime="2016-03-24T10:36:14+08:00">2016-03-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-03 16:24:13" itemprop="dateModified" datetime="2020-09-03T16:24:13+08:00">2020-09-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="runtime-给类别添加属性浅析"><a href="#runtime-给类别添加属性浅析" class="headerlink" title="runtime 给类别添加属性浅析"></a>runtime 给类别添加属性浅析</h2><p>很多时候因为需求想着给一个类添加属性，就是给一个类添加成员变量了，这样子方便了用这个类的时候，有了自己添加的属性，做什么事都是 信手捏来了。</p>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"></span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &lt;objc/runtime.h&gt; //千万别忘记添加哦</span><br><span class="line">@interfaceNSObject(FY)</span><br><span class="line">@property(nonatomic,copy)NSString* name;//像平时一样的添加属性</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>下面是在.m中实现的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">staticvoid* FYKeyName = (void*)&quot;FYKeyName&quot;;//声明这个变量要存储的key的名字</span><br><span class="line">@implementationNSObject(FY)</span><br><span class="line">- (void)setName:(NSString*)name&#123;</span><br><span class="line">objc_setAssociatedObject(self, FYKeyName, name, OBJC_ASSOCIATION_COPY);//把这个值存储起来类型是copy，值是name，存储的键值是&quot;FYKeyName&quot;,存储到self的属性里面</span><br><span class="line">&#125;</span><br><span class="line">- (NSString*)name&#123;</span><br><span class="line">returnobjc_getAssociatedObject(self, FYKeyName);//获取self的key为FYKeyName的值</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>到此为止这个属性已经添加完成了。<br>其实为毛添加属性啊，我们公司的按钮不能连续点击，是所有按钮。。。没错是all not some。我问Google大神了，搜到了消息是runtime解决问题，但是没找到如何解决。在我努力寻找。。。。一万字。。<br>终于知道runtime是运行时，什么是运行时呢？就是我们写的OC代码会让runtime翻译并且执行，runtime是一套比较底层的纯C语言API, 属于1个C语言库, 包含了很多底层的C语言API。<br>在我们平时编写的OC代码中, 程序运行过程时, 其实最终都是转成了runtime的C语言代码, runtime算是OC的幕后工作者。<br>所以给类添加属性就派上用场了，我解决思路是这样子的，给按钮添加类别就是点击事件间隔，执行点击事件的时候判断一下是否时间到了，如果时间不到，那么拦截点击事件。<br>怎么拦截点击事件呢？<br>其实点击事件在runtime里面是obj发送消息，我们可以把要发送的消息的SEL 和自己写的SEL交换一下，然后在自己写的SEL里面判断是否执行点击事件。【有点绕】<br>代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#import</span><br><span class="line">#import</span><br><span class="line">@interfaceUIControl(FY)</span><br><span class="line">@property(nonatomic,assign)NSTimeIntervalacceptEventInterval;</span><br><span class="line">@property(nonatomic)BOOLignoreEvent;</span><br><span class="line">@end</span><br><span class="line">@implementationUIControl(FYControl)</span><br><span class="line">staticconstchar*UIControl_acceptEventInterval=&quot;UIControl_acceptEventInterval&quot;;</span><br><span class="line">staticconstchar*UIControl_ignoreEvent=&quot;UIControl_ignoreEvent&quot;;</span><br><span class="line">@end</span><br><span class="line">@implementationUIControl(FY)</span><br><span class="line">- (void)setAcceptEventInterval:(NSTimeInterval)acceptEventInterval</span><br><span class="line">&#123;</span><br><span class="line">objc_setAssociatedObject(self,UIControl_acceptEventInterval, @(acceptEventInterval), OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">&#125;</span><br><span class="line">-(NSTimeInterval)acceptEventInterval &#123;</span><br><span class="line">return[objc_getAssociatedObject(self,UIControl_acceptEventInterval) doubleValue];</span><br><span class="line">&#125;</span><br><span class="line">-(void)setIgnoreEvent:(BOOL)ignoreEvent&#123;</span><br><span class="line">objc_setAssociatedObject(self,UIControl_ignoreEvent, @(ignoreEvent), OBJC_ASSOCIATION_ASSIGN);</span><br><span class="line">&#125;</span><br><span class="line">-(BOOL)ignoreEvent&#123;</span><br><span class="line">return[objc_getAssociatedObject(self,UIControl_ignoreEvent) boolValue];</span><br><span class="line">&#125;</span><br><span class="line">+(void)load &#123;</span><br><span class="line">Method a = class_getInstanceMethod(self,@selector(sendAction:to:forEvent:));</span><br><span class="line">Method b = class_getInstanceMethod(self,@selector(_sendAction:to:forEvent:));</span><br><span class="line">method_exchangeImplementations(a, b);//交换方法</span><br><span class="line">&#125;</span><br><span class="line">- (void)_sendAction:(SEL)action to:(id)target forEvent:(UIEvent*)event</span><br><span class="line">&#123;</span><br><span class="line">if(self.ignoreEvent)return;</span><br><span class="line">if(self.acceptEventInterval&gt;0)</span><br><span class="line">&#123;</span><br><span class="line">self.ignoreEvent=YES;</span><br><span class="line">[selfperformSelector:@selector(setIgnoreEventWithNo)  withObject:nilafterDelay:self.acceptEventInterval];</span><br><span class="line">&#125;</span><br><span class="line">[self_sendAction:action to:target forEvent:event];</span><br><span class="line">&#125;</span><br><span class="line">-(void)setIgnoreEventWithNo&#123;</span><br><span class="line">self.ignoreEvent=NO;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>用的时候很好用的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-(void)click&#123;</span><br><span class="line">btn =[[UIButton alloc]initWithFrame:CGRectMake(100,100,100,40)];</span><br><span class="line">[btnsetTitle:@&quot;btn&quot;forState:UIControlStateNormal];</span><br><span class="line">[btnsetTitleColor:[UIColor redColor]forState:UIControlStateNormal];</span><br><span class="line">btn.touchTimeValue =3;</span><br><span class="line">[self.viewaddSubview:btn];</span><br><span class="line">[btnaddTarget:selfaction:@selector(objcName)forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">输出：2016-03-1713:14:20.365runTimeObj[9297:2669428] 测试</span><br><span class="line">2016-03-1713:14:23.717runTimeObj[9297:2669428] 测试</span><br><span class="line">2016-03-1713:14:26.876runTimeObj[9297:2669428] 测试</span><br></pre></td></tr></table></figure>
<p>这个例子是利用了两个参数，一个参数Bool判断是否往下执行，一个时间用来修改Bool的值，最后就是执行方法b。有些同学纳闷，这执行方法b，不是执行自身方法吗？难道不是递归？其实不是，在load函数里面已经把a，b方法交换了。<br>这样子就可以操作一些系统方法了。后续还会出runtime在项目中的实际应用。</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fgyong.cn/2016/01/31/hexo换了电脑处理方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fgyong">
      <meta itemprop="description" content="在学习的路上，不忘初心 方得始终">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fgyong的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/01/31/hexo换了电脑处理方法/" class="post-title-link" itemprop="http://fgyong.cn/page/4/index.html">hexo换了电脑处理方法</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-01-31 12:02:22" itemprop="dateCreated datePublished" datetime="2016-01-31T12:02:22+08:00">2016-01-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-03 16:24:13" itemprop="dateModified" datetime="2020-09-03T16:24:13+08:00">2020-09-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/建站/" itemprop="url" rel="index"><span itemprop="name">建站</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="hexo换了电脑处理方法"><a href="#hexo换了电脑处理方法" class="headerlink" title="hexo换了电脑处理方法"></a>hexo换了电脑处理方法</h2><p>为了可以在多个电脑上面都处理hexo博客，所以我把source文件和网站的文件分别放在hexo和master分支上面了。<br>克隆到本地你的仓库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:ifgyongifgyong.github.io.git</span><br></pre></td></tr></table></figure></p>
<h2 id="然后切换到hexo分支上面"><a href="#然后切换到hexo分支上面" class="headerlink" title="然后切换到hexo分支上面"></a>然后切换到hexo分支上面</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout hexo</span><br><span class="line"></span><br><span class="line">运行 `hexo s --debug` 看看能不能正常启动。</span><br><span class="line">在浏览器打开 `localhost:4000`</span><br></pre></td></tr></table></figure>
<h2 id="然后测试是否在新的电脑上面能不能发表新的文章"><a href="#然后测试是否在新的电脑上面能不能发表新的文章" class="headerlink" title="然后测试是否在新的电脑上面能不能发表新的文章"></a>然后测试是否在新的电脑上面能不能发表新的文章</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo new &apos;测试&apos;</span><br><span class="line"></span><br><span class="line">hexo s --debug 然后打开`localhost:4000`就可以看见刚才发表的测试文章了</span><br></pre></td></tr></table></figure>
<h2 id="编译到git上面"><a href="#编译到git上面" class="headerlink" title="编译到git上面"></a>编译到git上面</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br><span class="line">然后打开你自己的网站，我的是fgyong.cn，查看文章上去没了没。</span><br></pre></td></tr></table></figure>
<p>我执行<code>hexo d</code>好几次都成功了，但是 网站上面的内容都没有更新，我就纳闷了。</p>
<h2 id="最终大招"><a href="#最终大招" class="headerlink" title="最终大招"></a>最终大招</h2><p>最后在知乎偶尔看见一个答案说是 删除仓库中的<code>.deploy_git</code>文件夹，然后在重新编译，部署。OK，新的文章出现了。</p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fgyong.cn/2016/01/30/Module-version-mismatch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fgyong">
      <meta itemprop="description" content="在学习的路上，不忘初心 方得始终">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fgyong的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/01/30/Module-version-mismatch/" class="post-title-link" itemprop="http://fgyong.cn/page/4/index.html">Module version mismatch</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-01-30 20:32:53" itemprop="dateCreated datePublished" datetime="2016-01-30T20:32:53+08:00">2016-01-30</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-03 16:24:13" itemprop="dateModified" datetime="2020-09-03T16:24:13+08:00">2020-09-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/建站/" itemprop="url" rel="index"><span itemprop="name">建站</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Module-version-mismatch"><a href="#Module-version-mismatch" class="headerlink" title="Module version mismatch"></a>Module version mismatch</h1><p>就是模块 版本不匹配了，我这个电脑是很久没用了<code>npm -v //2.*.*</code>，我在官网查了一下 npm 都已经3.*了，就索性把npm更新了一下<code>sudo npm i -g npm //更新npm</code>。然后在执行 <code>hexo s</code> 竟然还报错，错误如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MacBook:ifgyong.github.io fgy$ hexo -v</span><br><span class="line">[Error: Module version mismatch. Expected 46, got 47.]</span><br><span class="line">&#123; [Error: Cannot find module &apos;./build/default/DTraceProviderBindings&apos;] code: &apos;MODULE_NOT_FOUND&apos; &#125;</span><br><span class="line">&#123; [Error: Cannot find module &apos;./build/Debug/DTraceProviderBindings&apos;] code: &apos;MODULE_NOT_FOUND&apos; &#125;</span><br><span class="line">hexo: 3.1.1</span><br><span class="line">os: Darwin 15.3.0 darwin x64</span><br><span class="line">http_parser: 2.5.0</span><br><span class="line">node: 4.2.4</span><br><span class="line">v8: 4.5.103.35</span><br><span class="line">uv: 1.7.5</span><br><span class="line">zlib: 1.2.8</span><br><span class="line">ares: 1.10.1-DEV</span><br><span class="line">icu: 56.1</span><br><span class="line">modules: 46</span><br><span class="line">openssl: 1.0.2e</span><br></pre></td></tr></table></figure>
<p>在Google了好久终于发现一条解决这个问题的命令【出现这个的原因是装hexo的时候有些包没有下载下来】，执行下面的命令在查看hexo 版本的时候就不报错了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo --no-optional --save</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fgyong.cn/2016/01/28/iOS自动化打包第一步/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fgyong">
      <meta itemprop="description" content="在学习的路上，不忘初心 方得始终">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fgyong的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/01/28/iOS自动化打包第一步/" class="post-title-link" itemprop="http://fgyong.cn/page/4/index.html">iOS自动化打包第一步</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-01-28 17:32:06" itemprop="dateCreated datePublished" datetime="2016-01-28T17:32:06+08:00">2016-01-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-03 16:24:13" itemprop="dateModified" datetime="2020-09-03T16:24:13+08:00">2020-09-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="shell入门初探"><a href="#shell入门初探" class="headerlink" title="shell入门初探"></a>shell入门初探</h2><p>iOS打包有点烦人，现在就是想做个脚本一条命令执行之后打包然后上传到测试环境脚本。这是第一步在上传的基础上又写了一层上传只需要一条命令即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> #!/bin/bash </span><br><span class="line"> if [ $# != 1 ] //判断输入参数</span><br><span class="line">    then</span><br><span class="line">     echo &quot;请输入版本号&quot;//没有参数直接报错</span><br><span class="line">     exit             //退出</span><br><span class="line"> else</span><br><span class="line">     version=$&#123;1&#125;    //获取输入的版本号</span><br><span class="line">     shorder=&quot;./debug-publish.sh $&#123;version&#125; ios debug-$&#123;version&#125;.ipa&quot;//将要执行的shell脚本和命令</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      $shorder //执行字符串脚本</span><br><span class="line">      echo &quot;正在执行命令。。。&quot;</span><br><span class="line">      if [ $? -eq 0 ]//判断执行命令的结果是否成功 0是成功</span><br><span class="line">       then</span><br><span class="line">       echo &quot;push successed&quot;</span><br><span class="line">       else</span><br><span class="line">            echo &quot;push faild&quot;</span><br><span class="line">         fi</span><br><span class="line"></span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<pre><code>完成之后就可以使用了记得给这个脚本权限哦
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod +x yourShellFile //给执行权限</span><br><span class="line"></span><br><span class="line">./yourShellFile 1.1.1 //执行脚本在本目录下面</span><br></pre></td></tr></table></figure>

这是我的第一个脚本哦欢迎大虾指教。
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://fgyong.cn/2016/01/28/hexo自定义域名/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fgyong">
      <meta itemprop="description" content="在学习的路上，不忘初心 方得始终">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fgyong的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2016/01/28/hexo自定义域名/" class="post-title-link" itemprop="http://fgyong.cn/page/4/index.html">hexo自定义域名</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-01-28 11:44:52" itemprop="dateCreated datePublished" datetime="2016-01-28T11:44:52+08:00">2016-01-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-09-03 16:24:13" itemprop="dateModified" datetime="2020-09-03T16:24:13+08:00">2020-09-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/建站/" itemprop="url" rel="index"><span itemprop="name">建站</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="注册购买域名"><a href="#注册购买域名" class="headerlink" title="注册购买域名"></a>注册购买域名</h2><p>就像买淘宝的宝贝一样简单，<a href="http://wanwang.aliyun.com/domain/?spm=5176.200001.n2.13.iyigkk" target="_blank" rel="noopener">阿里云域名购买</a></p>
<h2 id="设置DNS"><a href="#设置DNS" class="headerlink" title="设置DNS"></a>设置DNS</h2><p> 设置IP地址的时候设置成github的IP具体获取方法是<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ nslookup fgyong.github.io//这个地址是你自己的地址下边的是输出来的，其中103.245.222.144便是上边需要的IP。</span><br><span class="line"> Server:        211.162.96.1</span><br><span class="line"> Address:    211.162.96.1#53</span><br><span class="line"></span><br><span class="line"> Non-authoritative answer: </span><br><span class="line"> fgyong.github.io    canonical name = github.map.fastly.net.</span><br><span class="line"> Name:    github.map.fastly.net</span><br><span class="line"> Address: 103.245.222.133</span><br></pre></td></tr></table></figure></p>
<h2 id="新建CNAME"><a href="#新建CNAME" class="headerlink" title="新建CNAME"></a>新建CNAME</h2><pre><code>在hexo文件目录source下边执行
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi CNAME //新建文件并打开</span><br><span class="line">然后把你买的域名写入文件退出并保存。</span><br><span class="line">比如我的是 http://fgyong.cn,写入文件的 网址是fgyong.cn.`没有http字样的`</span><br></pre></td></tr></table></figure>

然后
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">编译 hexo g</span><br><span class="line">上传github hexo d</span><br></pre></td></tr></table></figure>

大功告成，可以测试查看成果了。
</code></pre>
          
        
      
    </div>

    

    
    
    

    

    
       
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">fgyong</p>
              <p class="site-description motion-element" itemprop="description">在学习的路上，不忘初心 方得始终</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">44</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">24</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fgyong</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.6.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.6.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  










  





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>
